用 BurpSuite 攔截 iTunes 找回舊版的 iOS App 
====


其實網路上已經有很多類似的教學例如[在 Windows 系統上使用 Fiddler](http://www.feng.com/iPhone/news/2015-12-06/Feng-friends-sharing-how-to-use-iTunes-to-download-any-version-of-the-App_632306.shtml)或是[皮樂在 MacOS所使用 Charles](https://hiraku.tw/2015/12/4131/)的各種方法，我會推薦使用BurpSuite是因為他免費，然後其實也比較簡單用，所以就還是寫一篇如何用 BurpSuite 找回舊版的方法。


為什麼可以找回舊版 App ? 其實原因是蘋果都還是有保留舊版的 App 給系統版本較低的設備安裝，然後我們可以透過各種方法來攔截電腦端的 iTunes 跟蘋果伺服器溝通，這樣只要送出比較低版本號的要求，系統就會給我們舊版的安裝檔，這樣就可以達到 App 降版的目的。

## 所需軟體： 
[BurpSuite](https://portswigger.net/burp/)，請下載免費版本並安裝，免費的功能就足夠完成這件事情。理論上安裝完後會看到這畫面。

![]()

## 操作步驟：

### Step1: 設定 BurpSuite 攔截的封包

因為預設值是只會攔截發送出去的封包，不會攔截收到的封包，但是因為我們要知道該 App 有哪些版本號，所以要開啟攔截收到的封包，請切到 Option 分頁並往下拉把圖中紅框處的打勾。

### Step2: 打開 iTunes 找到你想要下載舊版的 App 並設定系統

這邊我以 Timehope 這 App 為例，首先把頁面開到可以按下載的這頁，但還先不要按下載，然後可以往下拉看到目前版本號是 3.5.3 


這時候請打開系統偏好設定，選擇網路，然後點選右下方的進階，並且將分頁切到代理伺服器，然後把 HTTP 跟 HTTPS 這兩項都勾選起來並且都填入 127.0.0.1:8080 ，這樣這整台電腦的 HTTP 與 HTTPS 流量都會透過 BurpSuite 才出去，這樣我們就可以達到修改流量的目的。

### Step3: 觀察 BurpSuite 的流量

這時後就回到 iTunes 按下載，然後切到 BurpSuite 理論上就會看到下面的畫面，然後只要一直按左上方的 Forward 就可以讓流量一直通過，然後等到看到有一個網址最尾是寫 /buyProduct 的時候往下拉，應該就會看到一大串的 array 請先把這複製到記事本或是任何可以記錄文字的地方再按下 Forward，然後就一直按 Forward 等到不用按的時後應該就已經下載完了。

註：如果一開始按 Forward 按太快忘記紀錄，可以切到 HTTP history 這頁面去找紀錄，一樣會有，然後記得他是在 Response 分頁中。

這是第一次下載，可以看到檔案是 44.6MB 然後版本是 3.5.3 


### Step4: 開始對封包動手腳

剛剛的目的只是為了拿到軟體的發佈碼，其實並沒有版法用這推出軟體版本，但可以慢慢的嘗試，所以這時候我就挑一組數字很小的的來測試。

請先把 iTunes 中的 App 砍了，然後讓頁面又變成是可以點選下載的狀況，然後一樣在按下載，這時候第一個跳出來的流量理論上會是這個，然後把 AppExtVrsId 的這組值換成剛剛找到的數值，然後在瘋狂按下 Forward ，這時候看下載的資訊，就發現到軟體大小變成 14.2MB 很明顯變成不同檔案了，然後等待實際下載完成也發現版本號是 1.7.1 。

這樣就算是完成了舊版檔案的下載，讓我們在複習一下流程：第一次下載是為了找到發佈碼，第二次下載就是替換發佈碼來拿到舊版 App ，然後千萬記得，用完要去系統偏好設定把 HTTPS 跟 HTTP 的代理伺服器關閉，不然一把 BurpSuite 關閉，你電腦就只會跟你說連線不到代理伺服器而無法上網了。



